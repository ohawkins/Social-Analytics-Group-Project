---
title: "OH work"
author: "Olivia Hawkins"
date: "11/3/2021"
output: word_document
---

Analysis:
- separate based on whether parent or child comment
- get sentiment of a post by taking average comment sentiment
- add a column to Shen's comment files to add sentiment
- add columns to Ben's movie file to show normalized sentiment
- graph normalized sentiments on a boxplot
- get dates of trailer and release date from URLs - Shen
- get days of the week and dummy variables - ME
- get Rotten Tomato scores - user and critic scores - ME
 - get Tomatometer score => dummy variable - ME
 - get Certified Fresh score => dummy variable - ME

- get scores in same table to do regression
- get average sentiment for each movie, synzhet, bin, afinn
- get top emotion of parent comments for each movie, release and trailer - ME, send code to Ben for him to do release
- datasets_cleaned: trailer:0 release:1

```{r}
# library(fastDummies)
setwd("~/OneDrive - University of Iowa/Social Analytics/Social-Analytics-Group-Project/Sentiment/")

df <- read.csv('movies.csv')

# Numbers collected from Rotten Tomatoes
lstTM <- c(.93, .71, .82, .76, .55, .63, .98, .94, .69, .91, .90, .84, .94, .98, .94, .72, .29, .74, .85, .26, .91, .71, .67, .59, .76, .92, .85, .93, .93, .85, .96, .47, .93, .65, .60, .30, .97, .84, .36, .94, .52, .78, .90, .79, .68, .52, .97, .57, .71)
lstAS <- c(.93, .78, .82, .83, .49, .61, .89, .87, .66, .91, .89, .86, .84, .92, .86, .62, .63, .79, .90, .59, .42, .80, .72, .53, .87, .87, .87, .87, .83, .91, .79, .48, .84, .74, .85, .81, .88, .85, .54, .90, .88, .92, .95, .45, .88, .86, .94, .94, .87) 

# Creating columns and adding data
df$TomatoMeter <- ''
df$AudienceScore <- ''
df$TomatoMeter <- lstTM
df$AudienceScore <- lstAS
df$Fresh <- ifelse(df$TomatoMeter >= .60, 1, 0)
df$CertifiedFresh <- ifelse(df$TomatoMeter >= .75, 1, 0)

# Transforming columns
df$date_trailer <- as.Date(df$date_trailer)
df$date_release <- as.Date(df$date_release)

# Adding days of the week
df$day_trailer <- weekdays(df$date_trailer)
df$day_release <- weekdays(df$date_release)

# Adding dummy variables
df <- dummy_cols(df, select_columns = 'day_trailer')
df <- dummy_cols(df, select_columns = 'day_release')

write.csv(df, 'movies_new.csv')
```

##Top Emotion from Parent Comments
```{r}
library(dplyr)
library(fastDummies)
library(janitor)
setwd("~/OneDrive - University of Iowa/Social Analytics/Social-Analytics-Group-Project/Sentiment/")

# get file names from Sentiment folder
file_names <- list.files(pattern='*.csv', full.names=FALSE)

# get dataframes
dftrailer <- read.csv("../movies_0_trailer.csv")
dfrelease <- read.csv("../movies_1_release.csv")

# the big whammo!
emotion <- function(filenames) {
    # set empty vector for emotion strings
    emotion_trailer <- c()
    emotion_release <- c()
    
    for (i in filenames) {
        # read in, filter comments, get highest row total
        df <- read.csv(i)
        dfparent <- filter(df, Parent == "True")
        dfparent <- adorn_totals(dfparent, where='row')
        rowmax <- max(dfparent[nrow(dfparent), (4:11)]) 
        
        # assign to variable
        emotion_str <- names(dfparent)[which(dfparent == rowmax, arr.ind=T)[, "col"]] # Thanks Shen!
        
        # check to see if there's a weird first column
        if (emotion_str[1] == "X") {
            emotion_str <- emotion_str[2]
        } else {
            emotion_str <- emotion_str[1]
        }
        #with emotion_str, append it to appropriate vector
        if (substr(i, 4, 4) == '1') {
            emotion_trailer <- c(emotion_trailer, emotion_str)
        } else if (substr(i, 4, 4) == '2') {
            emotion_release <- c(emotion_release, emotion_str)
        } else {print('YIKES')}
    }
    # assign to df
    dftrailer$top_sentiment <- emotion_trailer
    dfrelease$top_sentiment <- emotion_release
    # put new dataframes in global env
    dftrailer <<- dftrailer
    dfrelease <<- dfrelease
}

emotion(file_names)

# write to file
write.csv(dftrailer, '../movies_trailer.csv')
write.csv(dfrelease, '../movies_release.csv')
```
